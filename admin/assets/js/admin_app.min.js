"use strict";function passwordVerify(){function e(e,t,o,n){e.$watch(function(){var t;return(e.passwordVerify||n)&&(t=e.passwordVerify+"_"+n),t},function(t){t&&(n.$validators.passwordVerify=function(t){return e.passwordVerify===t})})}return{require:"ngModel",scope:{passwordVerify:"="},link:e}}var app=angular.module("myAdminApp",["ngRoute","ngMaterial","ngMessages","ui.bootstrap","ngFileUpload","ngImgCrop","angular-loading-bar","md.data.table","ngCookies","LocalStorageModule"]);app.constant("api_path","/admin_api/"),app.config(["localStorageServiceProvider",function(e){e.setPrefix("TASKYGIG-ADMIN")}]).config(["$httpProvider",function(e){e.interceptors.push(["$q","$rootScope","localStorageService",function(e,t,o){return{request:function(t){t.headers=t.headers||{};var n=o.cookie.get("user");return n&&(n=n.token,t.headers.Authorization="Bearer "+n),t||e.when(t)},response:function(t){return t||e.when(t)},responseError:function(o){return 401===o.status&&t.logout(),o||e.when(o)}}}])}]).config(["$mdThemingProvider",function(e){e.theme("error"),e.theme("success")}]).run(["$rootScope","$location","$timeout","cfpLoadingBar","$mdDialog","Toaster",function(e,t,o,n,a,r){e.isLogin=r.getSession(),e.selected=[],e.limitOptions=[10,20,50],e.query={order:"firstname",limit:10,page:1},e.$on("$routeChangeSuccess",function(a,r,s){e.checkRole(r.$$route.accessLevel)||t.path("/"),["/login","/reset-password"].indexOf(t.path())>=0?e.headerAndSidebar=!1:e.headerAndSidebar=!0,n.start(),o(function(){n.complete()},2e3),$("html,body").animate({scrollTop:0},500)}),e.$on("$routeChangeError",function(e,o,n,a){!0===a.authentication?t.path("/dashboard"):t.path("/login")}),e.$on("$locationChangeSuccess",function(e,o,n){var a=n.substr(0,n.indexOf("?"));a!==o.substr(0,o.indexOf("?"))&&a.length>0&&t.search("")}),e.$on("$routeChangeStart",function(){"/login"==t.path()?e.adminLoginPage=!0:e.adminLoginPage=!1}),e.go=function(e){t.path(e)},e.closeDialog=function(){a.hide()},e.logout=function(){localStorage.removeItem("token"),r.removeSession(),delete e.isLogin,t.path("/login")},e.checkRole=function(t){if(!t)return!0;var o={};return o.userRole=e.isLogin.user.type,o.status=!1,t&&angular.forEach(t,function(e){t.indexOf(o.userRole)>=0&&(o.status=!0)}),o.status}}]),app.config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"backend/dashboard/views/dashboard.html",controller:"DashboardController",resolve:{validate:required}}).when("/login",{templateUrl:"backend/landing/views/admin_login.html",controller:"authController",resolve:{validate:notRequired}}).when("/reset-password",{templateUrl:"backend/landing/views/reset.html",controller:"authController",resolve:{validate:notRequired}}).when("/profile",{templateUrl:"backend/profile/views/profile.html",controller:"ProfileController",resolve:{validate:required}}).when("/settings",{templateUrl:"backend/settings/views/index.html",controller:"SettingController",resolve:{validate:required}}).when("/managers",{templateUrl:"backend/managers/views/index.html",controller:"ManagerController",resolve:{validate:required},accessLevel:[1,2]}).when("/managers/add",{templateUrl:"backend/managers/views/add.html",controller:"ManagerController",resolve:{validate:required},accessLevel:[1,2]}).when("/managers/edit/:manager_id",{templateUrl:"backend/managers/views/edit.html",controller:"EditManagerController",resolve:{validate:required},accessLevel:[1,2]}).otherwise({redirectTo:"/"})}]);var required=["$q",function(e){var t=e.defer();return localStorage.getItem("token")?t.resolve():t.reject({authentication:!1}),t.promise}],notRequired=["$q",function(e){var t=e.defer();return localStorage.getItem("token")?t.reject({authentication:!0}):t.resolve(),t.promise}];app.run(["$rootScope",function(e){}]),app.factory("confirmationDialog",["$mdDialog",function(e){return{confirm:function(t,o){var n=e.confirm().title("Would you like to delete ?").textContent("Note: This is temporary delete. It can be restore.").targetEvent(t).ok("Ok").cancel("Cancel");o(e.show(n))}}}]),app.factory("htmlToText",[function(){return{convert:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText}}}]),app.factory("REST",["$http","api_path",function(e,t){return{GET:function(o,n){return e.get(t+o,n).then(function(e){return e.data})},POST:function(o,n){return e.post(t+o,n).then(function(e){return{statusCode:e.status,output:e.data.output,message:e.data.message,success:e.data.success}},function(e){return{error:e.data}})},PUT:function(o,n){return e.put(t+o,n).then(function(e){return{statusCode:e.status,output:e.data.output,message:e.data.message,success:e.data.success}},function(e){return{error:e.data}})},DELETE:function(o){return e.delete(t+o).then(function(e){return{statusCode:e.status,output:e.data.output,message:e.data.message,success:e.data.success}})},_LOGIN:function(o,n){return e.post(t+o,n).then(function(e){return{success:e.data.success,message:e.data.message,token:e.data.token,user:e.data.user}},function(e){return{message:e.data.errors}})}}}]),app.factory("sortIcon",[function(){return{set:function(e){var t;return $(e.target).hasClass("fa-sort-alpha-asc")?($(".sort i").attr("class","fa fa-sort-alpha-asc"),$(e.target).removeClass("fa-sort-alpha-asc").addClass("fa-sort-alpha-desc"),t=1):($(".sort i").attr("class","fa fa-sort-alpha-asc"),$(e.target).addClass("fa-sort-alpha-asc").removeClass("fa-sort-alpha-desc"),t=0),t}}}]),app.factory("timeout",["$timeout",function(e){return{hundredMiliSeconds:function(t){e(function(){t()},100)},twoSecond:function(t){e(function(){t()},2e3)}}}]),app.factory("Toaster",["$mdToast","localStorageService",function(e,t){return{simple:function(t,o){return o=o?"success":"error",e.show(e.simple().textContent(t).theme(o).position("top right").hideDelay(3e3))},setSession:function(e){return t.cookie.set("user",e,1),t.cookie.get("user")},getSession:function(){return t.cookie.get("user")},updateProfileImage:function(e){var o=t.cookie.get("user");return o.user.image=e,this.setSession(o),this.getSession()},removeSession:function(){return t.cookie.remove("user"),t.cookie.clearAll(),!0}}}]),app.controller("DashboardController",["$mdDialog","$cookies","$timeout","$routeParams","$scope","$rootScope","$location","REST",function(e,t,o,n,a,r,s,i){}]),app.controller("EditManagerController",["$timeout","$routeParams","$scope","$rootScope","$location","REST","Toaster",function(e,t,o,n,a,r,s){t.manager_id||a.path("/managers"),o.getUser=function(){r.GET("get-manager?_mid="+t.manager_id).then(function(e){o.admin=e.output})},o.getUser(),o.updateUser=function(){delete o.admin.created_at,delete o.admin.updated_at,r.POST("update-member?_mid="+o.admin._id,o.admin).then(function(e){s.simple(e.message,e.success),e.success&&a.path("/managers")})}}]),app.controller("ManagerController",["$mdDialog","$cookies","$timeout","$routeParams","$scope","$rootScope","$location","REST","Toaster","$httpParamSerializer",function(e,t,o,n,a,r,s,i,c,u){a.listUsers=function(){i.GET("list-managers?"+u(r.query)).then(function(e){a.data=e.output})},a.listUsers(),a.addUser=function(){i.POST("add-user",a.admin).then(function(e){c.simple(e.message,e.success),e.success&&s.path("/managers")})},a.removeUser=function(t,o){var n=e.confirm().title("Would you really like to delete this user?").ariaLabel("Remove Admin User").targetEvent(o).ok("Yes!").cancel("No");e.show(n).then(function(){i.DELETE("delete-manager?manager="+t).then(function(e){e.success&&a.listUsers(),c.simple(e.message,e.success)})})},a.quickAction=function(e){if(!a.selected.length)return void c.simple("Please choose some records first.",!1);i.POST("quick-action",{type:e,on:a.selected}).then(function(e){c.simple(e.message,e.success),e.success&&a.listUsers()})}}]),app.controller("ProfileController",["Upload","$routeParams","$scope","$rootScope","$location","REST","Toaster","$mdDialog","api_path",function(e,t,o,n,a,r,s,i,c){function u(){r.GET("profile-info").then(function(e){o.user=e.output})}u(),o.updateProfile=function(){r.POST("update-profile",o.user).then(function(e){e.success&&s.simple(e.message,e.success)})},o.changePassword=function(){var e={currentPassword:o.user.old,password:o.user.new,_id:o.user._id};o.user.confirm===o.user.new?r.POST("changePassword",e).then(function(e){e.success&&(o.user.new=null,o.user.old=null,o.user.confirm=null,o.passwordForm.$setPristine(),o.passwordForm.$setUntouched()),s.simple(e.message,e.success)}):s.simple("Confirm password must be same as New Password","false")},o.myImage="",o.myCroppedImage="",o.aspectRatio=2.8,o.selectFile=function(e,t){var n=["image/jpeg","image/jpg","image/png"];if(e&&-1===n.indexOf(e.type))return void s.simple("You can only upload image having file extension jpg, jpeg or png",!1);self.filename=e?e.name:"";var a=new FileReader;a.onload=function(e){o.$apply(function(o){o.myImage=e.target.result,t&&o.cropImagePopup()})},a.readAsDataURL(e)},o.cropImagePopup=function(){i.show({contentElement:"#imageDialog",parent:angular.element(document.body),clickOutsideToClose:!0})},o.uploadProfileImage=function(t,o){var a={dataUrl:t,imageName:self.filename};e.upload({url:c+"update-profile-image",data:{file:e.dataUrltoBlob(a.dataUrl,a.imageName)}}).then(function(e){n.closeDialog(),n.isLogin=s.updateProfileImage(e.data.output),e.data.success&&u()})}}]),app.controller("authController",["$scope","$location","REST","Toaster","$routeParams","$rootScope",function(e,t,o,n,a,r){function s(t){"add"===t?localStorage.setItem("remember",JSON.stringify(e.login)):localStorage.removeItem("remember")}e.form=1,e.login={remember:!1},localStorage.getItem("remember")&&(e.login=JSON.parse(localStorage.getItem("remember"))),e.adminLogin=function(){o._LOGIN("login",e.login).then(function(o){o.success?(s(e.login.remember?"add":"remove"),t.path("/dashboard"),localStorage.setItem("token",o.token),r.isLogin=n.setSession(o)):n.simple(o.message,!1)})},e.forgotPassword=function(){o.POST("forgot",e.forgot).then(function(t){e.forgot=null,e.forgotForm.$setPristine(),e.forgotForm.$setUntouched(),n.simple(t.message,t.success)})},a.reset||(e.nokey=!0),e.resetPassword=function(){e.reset.key=a.reset,o.POST("reset",e.reset).then(function(e){n.simple(e.message,e.success),e.success&&t.path("/login")})}}]),app.controller("includeController",["$mdDialog","$cookies","$timeout","Upload","$routeParams","$scope","$rootScope","$location","REST",function(e,t,o,n,a,r,s,i,c){!function(){angular.isUndefined(t.get("clickedOn"))&&t.put("clickedOn",".dashboard"),o(function(){angular.element(document.querySelector(t.get("clickedOn"))).addClass("active"),angular.element(document.querySelector(t.get("subMenu"))).addClass("active")},500)}(),r.selectMainMenu=function(e){var n=e.currentTarget.className.split(" "),a="."+n[1];-1==n.indexOf("active")&&(t.put("clickedOn",a),$(".treeview").removeClass("active"),o(function(){$(a).addClass("active")},500))},r.selectSubmenu=function(e){var o=e.currentTarget.className.split(" "),n="."+o[0];$(".treeview-menu li").removeClass("active"),t.put("subMenu",n),$(n).addClass("active")},r.hideSubmenu=function(){$(".treeview-menu").slideUp("slow")},r.profilePage=function(){i.path("/admin/profile")},r.changePasswordPage=function(){i.path("/admin/change-password")},r.comingSoon=function(t){e.show(e.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Module is under development").textContent("").ariaLabel("Alert Dialog Demo").ok("Ok").targetEvent(t))}}]),app.controller("SettingController",["$scope","$location","REST","Toaster","$parse","$mdDialog","Upload","api_path","$rootScope",function(e,t,o,n,a,r,s,i,c){o.GET("get-settings").then(function(t){if(t.success){var o,n,r,s,i;for(o=0;o<t.output.length;o++)n=t.output[o].meta_key,r=t.output[o].meta_value,s="settings."+n,i=a(s),i.assign(e,r)}}),e.updateSettings=function(){o.PUT("update-settings",e.settings).then(function(e){e.success&&n.simple(e.message,!0)})},e.myImage="",e.myCroppedImage="",e.aspectRatio=2.8,e.selectFile=function(t,o){var a=["image/jpeg","image/jpg","image/png"];if(t&&-1===a.indexOf(t.type))return void n.simple("You can only upload image having file extension jpg, jpeg or png",!1);self.filename=t?t.name:"";var r=new FileReader;r.onload=function(t){e.$apply(function(e){e.myImage=t.target.result,o&&e.cropImagePopup()})},r.readAsDataURL(t)},e.cropImagePopup=function(){r.show({contentElement:"#imageDialog",parent:angular.element(document.body),clickOutsideToClose:!0})},e.uploadProfileImage=function(e,t){var o={dataUrl:e,imageName:self.filename};s.upload({url:i+"update-logo",data:{file:s.dataUrltoBlob(o.dataUrl,o.imageName)}}).then(function(e){c.closeDialog()})}}]),app.directive("ascIcon",["$compile",function(e){return{restrict:"A",link:function(e,t,o){t.addClass("fa fa-sort-alpha-asc")}}}]),app.directive("fallbackSrc",function(){return{link:function(e,t,o){t.bind("error",function(){angular.element(this).attr("src",o.fallbackSrc)})}}}).directive("numbersOnly",function(){return{require:"ngModel",link:function(e,t,o,n){n.$parsers.push(function(e){if(void 0===e)return"";var t=e.replace(/[^0-9]/g,"");return t!=e&&(n.$setViewValue(t),n.$render()),t})}}}).directive("setHeight",["$window",function(e){return{restrict:"A",link:function(t,o,n){o.css("min-height",e.innerHeight-50+"px")}}}]).directive("backButton",function(){return{restrict:"A",link:function(e,t,o){t.on("click",function(){history.back(),e.$apply()})}}}).directive("passwordVerify",passwordVerify);